{"version":3,"sources":["../js/single-film.js"],"names":["searchParams","URLSearchParams","location","search","likes","document","getElementById","stars","querySelectorAll","filmId","get","fetchKinopoiskFilmData","answer","filmDetailsRequest","data","filmData","json","header","description","querySelector","posterImage","premiere","textContent","nameRu","src","posterUrl","premiereRu","fetchFilmMeta","fetch","body","views","ratingNumber","rating","ratings","reduce","a","b","parseInt","length","intRating","Math","round","isNaN","floor","i","star","classList","add","starsFunction","likeIcon","FILM_KEY","liked","localStorage","getItem","addEventListener","contains","setItem","likeCount","innerText","method","headers","$","on","console","log","JSON","stringify","dataset","value"],"mappings":"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","sourcesContent":["const searchParams = new URLSearchParams(location.search);\r\nconst likes = document.getElementById('sf-likes');\r\nconst stars = document.querySelectorAll('.rating-star');\r\n\r\nconst filmId = searchParams.get('id');\r\n\r\nconst fetchKinopoiskFilmData = async () => {\r\n    const answer = await filmDetailsRequest(filmId);\r\n    const {data: filmData} = await answer.json();\r\n\r\n    const header = document.getElementById('sf-header');\r\n    const description = document.querySelector('#sf-description');\r\n    const posterImage = document.querySelector('#sf-poster');\r\n    const premiere = document.getElementById('sf-premiere');\r\n\r\n    header.textContent = filmData.nameRu;\r\n    description.textContent = filmData.description;\r\n    posterImage.src = filmData.posterUrl;\r\n    premiere.textContent = filmData.premiereRu;\r\n}\r\n\r\nconst fetchFilmMeta = async () => {\r\n    const answer = await fetch(`http://inno-ijl.ru/multystub/stc-21-03/film/${filmId}`);\r\n    const {body} = await answer.json();\r\n\r\n    const views = document.getElementById('sf-views');\r\n    const likes = document.getElementById('sf-likes');\r\n    const ratingNumber = document.getElementById('sf-rating-number');\r\n    const stars = document.querySelectorAll('.rating-star')\r\n\r\n    views.textContent = `${body.views} Views`;\r\n    likes.textContent = `${body.likes} Likes`;\r\n    const rating = body.ratings.reduce((a, b) => parseInt(a) + parseInt(b), 0) / body.ratings.length;\r\n    const intRating = Math.round(rating);\r\n    if (isNaN(intRating)) {\r\n        ratingNumber.textContent = '0.0'\r\n    } else {\r\n        ratingNumber.textContent = Math.floor(rating * 10) / 10;\r\n    }\r\n\r\n\r\n\r\n    for (let i = 0; i < stars.length; i++) {\r\n        if (i >= intRating) break;\r\n\r\n        const star = stars[i];\r\n        star.classList.add('star-selected')\r\n    }\r\n}\r\n\r\nconst starsFunction = async () => {\r\n    const answer = await fetch(`http://inno-ijl.ru/multystub/stc-21-03/film/${filmId}`);\r\n    const {body} = await answer.json();\r\n\r\n    const ratingNumber = document.getElementById('sf-rating-number');\r\n    const stars = document.querySelectorAll('.rating-star')\r\n    const rating = body.ratings.reduce((a, b) => parseInt(a) + parseInt(b), 0) / body.ratings.length;\r\n    const intRating = Math.round(rating);\r\n    if (isNaN(intRating)) {\r\n        ratingNumber.textContent = '0.0'\r\n    } else {\r\n        ratingNumber.textContent = Math.floor(rating * 10) / 10;\r\n    }\r\n\r\n    for (let i = 0; i < stars.length; i++) {\r\n        if (i >= intRating) break;\r\n\r\n        const star = stars[i];\r\n        star.classList.add('star-selected')\r\n    }\r\n}\r\n\r\nconst likeIcon = document.getElementById('like-icon');\r\nconst FILM_KEY = `film-${filmId}`;\r\nconst liked = localStorage.getItem(FILM_KEY);\r\n\r\nif (liked !== null) {\r\n    likeIcon.classList.add('like-icon--liked');\r\n}\r\nlikeIcon.addEventListener('click', () => {\r\n   \r\n    if (!likeIcon.classList.contains('like-icon--liked')) {\r\n        localStorage.setItem(FILM_KEY, true)\r\n        const likeCount = parseInt(likes.textContent, 10) + 1;\r\n\r\n\r\n        likes.innerText = `${likeCount} Likes`;\r\n        likeIcon.classList.add('like-icon--liked');\r\n        likes.classList.add('like-icon--liked');\r\n\r\n\r\n        fetch(\r\n            `http://inno-ijl.ru/multystub/stc-21-03/film/${filmId}/like`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json'\r\n                },\r\n            }\r\n        )\r\n    }\r\n});\r\n\r\n// for (const star of stars) {\r\n//     star.addEventListener('click', () => {\r\n\r\n//         fetch(`http://inno-ijl.ru/multystub/stc-21-03/film/${filmId}/rating`, {\r\n//             method: 'POST',\r\n//             headers: {\r\n//                 'Content-Type': 'application/json'\r\n//             },\r\n//             body: JSON.stringify({\r\n//                 rating: +star.dataset.value\r\n//             })\r\n//         });\r\n\r\n//         fetchFilmMeta();\r\n\r\n//     });\r\n// };\r\n\r\n\r\n$('.stars-wrapper').on('click', '.rating-star', async function () {\r\n   console.log('stars');\r\n    await fetch(`http://inno-ijl.ru/multystub/stc-21-03/film/${filmId}/rating`, {\r\n        method: 'POST',\r\n        headers: {\r\n            'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({\r\n            rating: +this.dataset.value\r\n        })\r\n    });\r\n    // fetchFilmMeta();\r\n    starsFunction();\r\n    \r\n})\r\n\r\nfetchKinopoiskFilmData();\r\nfetchFilmMeta();"],"file":"single-film.js"}