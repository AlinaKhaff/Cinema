{"version":3,"sources":["../js/blocks-films.js"],"names":["blockFilmsWrapper","document","getElementById","kinopoiskapiunofficialRequest","url","fetch","headers","cors","topFilmsRequest","filmDetailsRequest","id","renderFilmBlock","posterUrl","filmName","wrapper","createElement","classList","add","link","href","imagesWrapper","images","src","alt","append","shadow","descWrapper","title","textContent","desc","fetchBlockFilms","result","films","json","request","filmBlockMap","Map","forEach","film","filmBlock","posterUrlPreview","nameRu","filmId","set","push","Promise","resolve","reject","detailResult","detailsData","description","data","delete","all","element","values","slice","innerHTML"],"mappings":"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","sourcesContent":["const blockFilmsWrapper = document.getElementById('block05-films-wrapper');\r\n\r\nconst kinopoiskapiunofficialRequest = (url) => {\r\n    return fetch(url, {\r\n        headers: {\r\n            'accept': 'application/json',\r\n            'X-API-KEY': '18977bf3-8146-4afe-9205-6dabd925546d'\r\n        },\r\n\r\n        cors: 'no-cors'\r\n    });\r\n}\r\n\r\nconst topFilmsRequest = () => {\r\n    return kinopoiskapiunofficialRequest('https://kinopoiskapiunofficial.tech/api/v2.2/films/top?type=TOP_AWAIT_FILMS&page=1')\r\n}\r\nconst filmDetailsRequest = (id) => {\r\n    return kinopoiskapiunofficialRequest(`https://kinopoiskapiunofficial.tech/api/v2.1/films/${id}`)\r\n}\r\n\r\nfunction renderFilmBlock(posterUrl, filmName, id) {\r\n    const wrapper = document.createElement('div');\r\n    wrapper.classList.add('block05__movie1');\r\n\r\n    const link = document.createElement('a');\r\n    link.href = `/single/?id=${id}`\r\n\r\n    const imagesWrapper = document.createElement('div');\r\n    imagesWrapper.classList.add('block05__bg');\r\n    const images = document.createElement('img');\r\n    images.src = posterUrl;\r\n    images.alt = 'Изображение постера';\r\n\r\n    imagesWrapper.append(images);\r\n\r\n    const shadow = document.createElement('div');\r\n    shadow.classList.add('block05__shadow');\r\n\r\n    const descWrapper = document.createElement('div');\r\n    descWrapper.classList.add('block05__descr');\r\n\r\n\r\n    const title = document.createElement('div');\r\n    title.classList.add('block05__text2');\r\n    title.textContent = filmName;\r\n\r\n    const desc = document.createElement('div')\r\n    desc.classList.add('block05__text3');\r\n    desc.textContent = '...Loading';\r\n\r\n    descWrapper.append(title, desc);\r\n    link.append(imagesWrapper, shadow, descWrapper);\r\n    wrapper.append(link);\r\n\r\n\r\n    return [wrapper, desc];\r\n\r\n\r\n}\r\n\r\nconst fetchBlockFilms = async () => {\r\n    const result = await topFilmsRequest();\r\n    const {\r\n        films\r\n    } = await result.json();\r\n\r\n    const request = [];\r\n    const filmBlockMap = new Map();\r\n\r\n    films.forEach((film) => {\r\n        const [filmBlock, desc] = renderFilmBlock(film.posterUrlPreview, film.nameRu, film.filmId);\r\n        filmBlockMap.set(film.filmId, filmBlock);\r\n\r\n        request.push(new Promise(async (resolve, reject) => {\r\n            const detailResult = await filmDetailsRequest(film.filmId);\r\n            const detailsData = await detailResult.json();\r\n\r\n\r\n            const description = detailsData.data.description;\r\n\r\n            if (!description) {\r\n                filmBlockMap.delete(film.filmId)\r\n            } else {\r\n                desc.textContent = description;\r\n            }\r\n            resolve();\r\n        }));\r\n\r\n    })\r\n\r\n    await Promise.all(request);\r\n\r\n    const element = [...filmBlockMap.values()].slice(0, 9);\r\n    blockFilmsWrapper.innerHTML = '';\r\n    blockFilmsWrapper.append(...element);\r\n\r\n}\r\n\r\nfetchBlockFilms();\r\n\r\n\r\n// blockFilmsWrapper.innerHTML = '';\r\n// const apiHeaders = {\r\n//   'accept': 'application/json',\r\n//   'X-API-KEY': '18977bf3-8146-4afe-9205-6dabd925546d'\r\n// };\r\n// fetch('https://kinopoiskapiunofficial.tech/api/v2.1/films/top?type=TOP_AWAIT_FILMS&page=1', {\r\n//   headers: { ...apiHeaders\r\n//   },\r\n//   cors: 'no-cors'\r\n// }).then(data => data.json()).then(data => {\r\n//   data.films.forEach((film, index) => {\r\n//     const id = `block05-films-desc-${film.filmId}`;\r\n//     blockFilmsWrapper.innerHTML += `\r\n//                 <div class=\"block05__movie1\"> \r\n//                     <div class = \"block05__bg\" >\r\n//                     <div class=\"block05__shadow\"></div>\r\n//                        <img src = ${film.posterUrlPreview} alt = \"\"/></div>\r\n//                            <div class = \"block05__descr\">\r\n//                               <div class = \"block05__text2\">${film.nameRu} </div> \r\n//                                  <div id=${id} class = \"block05__text3\"> ...Loading\r\n//                    </div> \r\n//                   </div>\r\n\r\n//                 </div>`;\r\n//     fetch(`https://kinopoiskapiunofficial.tech/api/v2.1/films/${film.filmId}`, {\r\n//       headers: { ...apiHeaders\r\n//       },\r\n//       cors: 'no-cors'\r\n//     }).then(data => data.json()).then(({\r\n//       data: {\r\n//         description\r\n//       }\r\n//     }) => {\r\n//       const desc = document.getElementById(id);\r\n//       desc.innerText = description;\r\n\r\n//       if (!description) {\r\n//         const root = desc.parentNode.parentNode;\r\n//         blockFilmsWrapper.removeChild(root);\r\n//       }\r\n//     });\r\n//   });\r\n// });"],"file":"blocks-films.js"}